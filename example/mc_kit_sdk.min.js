(function(k,r,t){function b(){return b}function q(a,c){a&&parent.postMessage({action:a.toUpperCase(),message:c},"*")}var n,f,d,e=[],l=[],m=[];n=k.MCK;d={PRISTINE:0,PENDING:1,REJECTED:2,RESOLVED:3};f=d.PRISTINE;b.version="1.0.6";b.h5={};(function(){r.addEventListener("message",function(a){var c=a.data;a=c.action;var b=c.message,c=!!c.isKeepListen;if(0!==e.length&&(f===d.RESOLVED||"AUTH_SUCCESS"===a))for(var g=e.length,h;g--;)h=e[g],a===h.action&&(h.callback(b,h),h.once&&!c&&e.splice(g,1))})})();b.auth=
function(){f=d.PENDING;var a;a=document.getElementsByTagName("script");a=a[a.length-1].src.match(/[\?&]appkey=([^&]+)/i)[1];q("auth",{appKey:a,domain:location.origin})};b.ready=function(a,c){if("function"!==typeof a)return b;switch(f){case d.RESOLVED:a(b);break;case d.PRISTINE:case d.PENDING:l.push(a);break;default:"function"===typeof c&&c()}return b};b.h5.call=function(a,c,p){var g;switch(f){case d.PRISTINE:throw Error("\u8bf7\u786e\u8ba4\u4f60\u7684 appKey \u6b63\u786e.");case d.PENDING:console.log("\u4ecd\u5728\u9a8c\u8bc1\u4e2d.. \u8bf7\u4f7f\u7528 `MCK.ready(fn)` \u6ce8\u518c\u56de\u8c03.");
break;case d.RESOLVED:g=!0;break;default:throw Error("\u8bf7\u786e\u8ba4\u4f60\u7684 appKey \u6b63\u786e.");}if(g)if(a&&-1!==m.indexOf(a.toUpperCase()))"function"===typeof c&&(p=c,c=t),a=a+"_"+(new Date).getTime(),q(a,c),"function"===typeof p&&b.h5.watchOnce(a,function(a){p(a)});else throw Error("\u672a\u627e\u5230\u8be5 ["+a+"] API, \u8bf7\u786e\u8ba4\u4f60\u8c03\u7528\u7684 API .");};b.h5.watch=function(a,c,b){var d;if("string"===typeof a&&"function"===typeof c)return b=b||{},d=(d=b.flag)||(new Date).getTime()+
(Math.random()+"").substring(2,4),e.push({once:b.once,flag:d,action:a.toUpperCase(),callback:c}),d};b.h5.watchOnce=function(a,c,d){d=d||{};d.once=!0;b.h5.watch(a,c,d);return b};b.h5.unWatch=function(a){for(var c=e.length;c--;)if(a===e[c].flag){e.splice(c,1);break}return b};b.h5.getApi=function(){return m.concat()};b.conflict=function(){k.MCK=n;n=null;return Object.create(b)};b.auth();b.h5.watchOnce("AUTH_SUCCESS",function(a){a?f=d.RESOLVED:(l.length=0,f=d.REJECTED)});b.h5.watchOnce("AVAILABLE_API",
function(a){var c;m.push.apply(m,a);0!==l.length&&(c=k.MCK,c=b.isPrototypeOf(c)?c:Object.create(b),l.forEach(function(a){a.call(null,c)}))});k.MCK=Object.create(b)})(this,window);
